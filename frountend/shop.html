<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shiv Krishi Farm</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-green-50 text-gray-800">

  <!-- Navbar -->
  <nav class="bg-green-700 text-white p-4 flex justify-between items-center shadow-lg">
    <div class="flex items-center space-x-3">
      <img src="./pic/Gemini-logo.png" alt="Farm Logo" class="h-12 w-12 rounded-full ">
      <h1 class="text-xl font-bold">Shiv Krishi Farm</h1>
    </div>
    <button onclick="toggleCart()" class="bg-yellow-400 text-black px-4 py-2 rounded-lg font-semibold">
      ðŸ›’ Cart (<span id="cartCount">0</span>)
    </button>
  </nav>

  <!-- Hero Section -->
  <header class="text-center py-10 bg-gradient-to-r from-green-200 to-green-400">
    <h2 class="text-3xl font-bold">ðŸŒ± Welcome to Shiv Krishi Farm</h2>
    <p class="mt-2 text-lg">Fresh Vegetables Direct from Our Fields</p>
  </header>

  <!-- Product Section -->
  <section id="productSection" class="p-6 grid md:grid-cols-3 gap-6"></section>

  <!-- Cart Section -->
  <div id="cartBox" class="hidden fixed right-5 top-20 bg-white p-6 shadow-xl rounded-lg w-96">
    <h2 class="text-xl font-bold mb-4">ðŸ›’ Your Cart</h2>
    <ul id="cartItems" class="space-y-2"></ul>
    <p class="font-bold mt-4">Total: â‚¹<span id="cartTotal">0</span></p>

    <!-- Checkout Form -->
    <h4 class="mt-6 text-xl font-bold">Checkout</h4>
    <form id="checkoutForm" class="mt-3 space-y-3">
      <input id="custName" type="text" placeholder="Your Name" class="w-full p-2 border rounded" required>
      <input id="custPhone" type="text" placeholder="Phone Number" class="w-full p-2 border rounded" required>
      <textarea id="custAddress" placeholder="Delivery Address" class="w-full p-2 border rounded" required></textarea>
      <button type="button" onclick="sendToWhatsApp()" class="bg-green-700 text-white px-4 py-2 rounded-lg w-full">
        Proceed via WhatsApp
      </button>
    </form>
  </div>

<script>
const API = "https://farm-ody6.onrender.com/api/products";
let cart = [];

// ----- Fetch products from backend -----
async function loadProducts() {
  const res = await fetch(API);
  const products = await res.json();
  const section = document.getElementById("productSection");
  section.innerHTML = "";

  products.forEach(product => {
    section.innerHTML += `
      <div class="bg-white shadow-md p-4 rounded-lg text-center">
        <img src="${product.image}" class="h-24 mx-auto" alt="${product.name}">
        <h3 class="font-bold text-lg mt-2">${product.name}</h3>
        <p class="text-gray-600">â‚¹${product.price} / Kg</p>

        <div class="flex justify-center items-center mt-2 space-x-2">
          <button onclick="decreaseQty('${product._id}')" class="bg-red-500 text-white px-2 rounded">-</button>
          <input id="${product._id}Qty" type="number" value="1" min="1" class="w-12 text-center border rounded">
          <button onclick="increaseQty('${product._id}')" class="bg-green-500 text-white px-2 rounded">+</button>
        </div>

        <button onclick="addToCart('${product.name}', ${product.price}, '${product._id}Qty')" class="mt-3 bg-green-700 text-white px-4 py-2 rounded-lg">
          Add to Cart
        </button>
      </div>
    `;
  });
}

// ----- Quantity functions -----
function increaseQty(id) {
  let input = document.getElementById(id);
  input.value = parseInt(input.value) + 1;
}

function decreaseQty(id) {
  let input = document.getElementById(id);
  if(parseInt(input.value) > 1) input.value = parseInt(input.value) - 1;
}

// ----- Cart functions -----
function addToCart(name, price, qtyId) {
  let qty = parseInt(document.getElementById(qtyId).value);
  let existing = cart.find(item => item.name === name);

  if(existing){
    existing.qty += qty;
  } else {
    cart.push({ name, price, qty });
  }

  updateCartCount();
  alert(`${qty} Kg ${name} added to cart!`);
}

function updateCartCount() {
  let totalQty = cart.reduce((sum, item) => sum + item.qty, 0);
  document.getElementById("cartCount").innerText = totalQty;
}

function toggleCart() {
  document.getElementById("cartBox").classList.toggle("hidden");
  displayCart();
}

function displayCart() {
  let cartItems = document.getElementById("cartItems");
  cartItems.innerHTML = "";
  let total = 0;

  if(cart.length === 0){
    cartItems.innerHTML = "<li>Your cart is empty</li>";
    document.getElementById("cartTotal").innerText = 0;
    return;
  }

  cart.forEach((item, index) => {
    let itemTotal = item.price * item.qty;
    total += itemTotal;
    cartItems.innerHTML += `
      <li class="flex justify-between items-center border-b pb-1">
        <span>${index+1}. ${item.name} - ${item.qty} Kg = â‚¹${itemTotal}</span>
        <button onclick="removeFromCart(${index})" class="bg-red-500 text-white px-2 py-1 rounded ml-2 hover:bg-red-600">Delete</button>
      </li>
    `;
  });

  document.getElementById("cartTotal").innerText = total;
}

function removeFromCart(index) {
  cart.splice(index,1);
  updateCartCount();
  displayCart();
}

function sendToWhatsApp() {
  let name = document.getElementById("custName").value;
  let phone = document.getElementById("custPhone").value;
  let address = document.getElementById("custAddress").value;

  if (!name || !phone || !address) {
    alert("âš ï¸ Please fill all details before proceeding.");
    return;
  }

  if (!cart || cart.length === 0) {
    alert("âš ï¸ Your cart is empty!");
    return;
  }

  // Build message using %0A for line breaks
  let orderDetails = "ðŸ›’ *New Order from Shiv Krishi Farm*%0A%0A";
  orderDetails += `*Customer Name:* ${name}%0A`;
  orderDetails += `*Phone:* ${phone}%0A`;
  orderDetails += `*Address:* ${address}%0A%0A`;
  orderDetails += "ðŸ“¦ *Order Items:*%0A";

  let order = ["ðŸ›’ *New Order from Shiv Krishi Farm*%0A%0A",]

  let total = 0;
  cart.forEach((item, index) => {
    let itemTotal = item.price * item.qty;
    orderDetails += `_${index + 1}._ *${item.name}* - ${item.qty} Kg = â‚¹${itemTotal}%0A`;
    total += itemTotal;
  });

  orderDetails += `%0AðŸ’° *Total:* â‚¹${total}`;

  // WhatsApp link
  let whatsappNumber = "919627938726"; // Your number
  let url = `https://wa.me/${whatsappNumber}?text=${orderDetails}`;
  
  window.open(url, "_blank");
}



// ----- Load products on page load -----
loadProducts();
</script>

</body>
</html>
